<!DOCTYPE html>
<html>
<head>
    <title>Mapa com Imagem Georreferenciada</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        #map { height: 600px; } 
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        // 1. Definição da Projeção EPSG:4326
        var crs = L.CRS.EPSG4326;

        // 2. Mapa Base OpenStreetMap
        var basemap = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	subdomains: 'abcd',
	maxZoom: 20
});

        // 3. Criação do Mapa
        var map = L.map('map', {
            crs: crs,
            center: [0, 0], // Centro inicial temporário
            zoom: 2,
            layers: [basemap]
        });

        // 5. Função para Carregar e Georreferenciar a Imagem
        fetch('camadas/coordenadas.txt')
            .then(response => response.text())
            .then(coordsText => {
                const coords = coordsText.split(',').map(Number);

                // 6. Cálculo do Centro da Imagem
                const centerLat = (coords[1] + coords[3]) / 2;
                const centerLng = (coords[0] + coords[2]) / 2;

                // Criação do Objeto ImageOverlay
                var imageOverlay = L.imageOverlay('camadas/ortofoto.png', [
                    [coords[1], coords[0]],
                    [coords[3], coords[2]]
                ], { crs: crs }).addTo(map);

                // Centralizar o Mapa na Imagem
                map.setView([centerLat, centerLng], 10); // Zoom inicial ajustado (10)
            });
    </script>
</body>
</html>